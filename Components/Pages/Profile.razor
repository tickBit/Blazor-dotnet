@page "/profile"
@attribute [Authorize]

@using System.Security.Claims
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthStateProvider

<h3>Profile</h3>

@if (userEmail is null)
{
    <p>Loading...</p>
}
else
{
    <div class="card">
        <div class="card-body">
            <p>
                <strong>Email:</strong><br />
                @userEmail
            </p>

            <form method="post" action="/auth/delete-account"
                  onsubmit="return confirm('Are you sure, you want delete your account? This action cannot be undone.');">
                <button type="submit" class="btn btn-danger">
                    Delete my account
                </button>
            </form>
        </div>
    </div>
}

@code {
    private string? userEmail;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        userEmail = user.FindFirst(ClaimTypes.Email)?.Value;
    }
}
